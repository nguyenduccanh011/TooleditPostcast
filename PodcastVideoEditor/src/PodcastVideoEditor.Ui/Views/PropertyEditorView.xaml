<UserControl x:Class="PodcastVideoEditor.Ui.Views.PropertyEditorView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:views="clr-namespace:PodcastVideoEditor.Ui.Views"
             xmlns:conv="clr-namespace:PodcastVideoEditor.Ui.Converters"
             Background="#1e1e1e"
             Foreground="#e0e0e0"
             MinWidth="220">

    <UserControl.Resources>
        <!-- String -->
        <DataTemplate x:Key="PropertyFieldStringTemplate">
            <Grid Margin="0,0,0,12">
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>
                <TextBlock Text="{Binding Name}" Foreground="#b0bec5" FontWeight="SemiBold" Margin="0,0,0,4"/>
                <TextBox Grid.Row="1" Text="{Binding Value, UpdateSourceTrigger=PropertyChanged}"
                         Background="#2d2d2d" Foreground="#e0e0e0" Padding="8,5"
                         BorderBrush="#546e7a" BorderThickness="1"/>
            </Grid>
        </DataTemplate>

        <!-- TextArea -->
        <DataTemplate x:Key="PropertyFieldTextAreaTemplate">
            <Grid Margin="0,0,0,12">
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>
                <TextBlock Text="{Binding Name}" Foreground="#b0bec5" FontWeight="SemiBold" Margin="0,0,0,4"/>
                <TextBox Grid.Row="1" Text="{Binding Value, UpdateSourceTrigger=PropertyChanged}"
                         Background="#2d2d2d" Foreground="#e0e0e0" Padding="8,5"
                         BorderBrush="#546e7a" BorderThickness="1"
                         TextWrapping="Wrap" AcceptsReturn="True" Height="60"
                         VerticalScrollBarVisibility="Auto"/>
            </Grid>
        </DataTemplate>

        <!-- Int -->
        <DataTemplate x:Key="PropertyFieldIntTemplate">
            <Grid Margin="0,0,0,12">
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>
                <TextBlock Text="{Binding Name}" Foreground="#b0bec5" FontWeight="SemiBold" Margin="0,0,0,4"/>
                <TextBox Grid.Row="1" Text="{Binding Value, UpdateSourceTrigger=PropertyChanged}"
                         Background="#2d2d2d" Foreground="#e0e0e0" Padding="8,5"
                         BorderBrush="#546e7a" BorderThickness="1"/>
            </Grid>
        </DataTemplate>

        <!-- Float -->
        <DataTemplate x:Key="PropertyFieldFloatTemplate">
            <Grid Margin="0,0,0,12">
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>
                <TextBlock Text="{Binding Name}" Foreground="#b0bec5" FontWeight="SemiBold" Margin="0,0,0,4"/>
                <TextBox Grid.Row="1" Text="{Binding Value, UpdateSourceTrigger=PropertyChanged}"
                         Background="#2d2d2d" Foreground="#e0e0e0" Padding="8,5"
                         BorderBrush="#546e7a" BorderThickness="1"/>
            </Grid>
        </DataTemplate>

        <!-- Color (hex string + preview) -->
        <DataTemplate x:Key="PropertyFieldColorTemplate">
            <Grid Margin="0,0,0,12">
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>
                <TextBlock Text="{Binding Name}" Foreground="#b0bec5" FontWeight="SemiBold" Margin="0,0,0,4"/>
                <Grid Grid.Row="1">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="32"/>
                        <ColumnDefinition Width="*"/>
                    </Grid.ColumnDefinitions>
                    <Border Width="28" Height="24" CornerRadius="2" Margin="0,0,8,0"
                            Background="{Binding Value, Converter={StaticResource HexToBrushConverter}}"
                            BorderBrush="#546e7a" BorderThickness="1"/>
                    <TextBox Grid.Column="1" Text="{Binding Value, UpdateSourceTrigger=PropertyChanged}"
                             Background="#2d2d2d" Foreground="#e0e0e0" Padding="8,5"
                             BorderBrush="#546e7a" BorderThickness="1"/>
                </Grid>
            </Grid>
        </DataTemplate>

        <!-- Enum -->
        <DataTemplate x:Key="PropertyFieldEnumTemplate">
            <Grid Margin="0,0,0,12">
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>
                <TextBlock Text="{Binding Name}" Foreground="#b0bec5" FontWeight="SemiBold" Margin="0,0,0,4"/>
                <ComboBox Grid.Row="1" ItemsSource="{Binding EnumValues}"
                          SelectedItem="{Binding Value, UpdateSourceTrigger=PropertyChanged}"
                          Background="#2d2d2d" Foreground="#e0e0e0" Padding="8,5"
                          BorderBrush="#546e7a" BorderThickness="1"/>
            </Grid>
        </DataTemplate>

        <!-- Bool -->
        <DataTemplate x:Key="PropertyFieldBoolTemplate">
            <Grid Margin="0,0,0,12">
                <CheckBox Content="{Binding Name}" IsChecked="{Binding Value, UpdateSourceTrigger=PropertyChanged}"
                          Foreground="#b0bec5" FontWeight="SemiBold"/>
            </Grid>
        </DataTemplate>

        <!-- Slider -->
        <DataTemplate x:Key="PropertyFieldSliderTemplate">
            <Grid Margin="0,0,0,12">
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>
                    <TextBlock Text="{Binding Name}" Foreground="#b0bec5" FontWeight="SemiBold" Margin="0,0,0,4"/>
                    <TextBlock Grid.Column="1" Text="{Binding Value}" Foreground="#81c784"
                               FontFamily="Courier New" FontSize="12" Margin="8,0,0,4"/>
                </Grid>
                <Slider Grid.Row="1" Minimum="{Binding MinValue}" Maximum="{Binding MaxValue}"
                        Value="{Binding Value, UpdateSourceTrigger=PropertyChanged}"
                        IsMoveToPointEnabled="True" Height="24"
                        Background="#37474f" Foreground="#64b5f6"/>
            </Grid>
        </DataTemplate>

        <views:PropertyFieldTemplateSelector x:Key="PropertyFieldTemplateSelector"
            StringTemplate="{StaticResource PropertyFieldStringTemplate}"
            TextAreaTemplate="{StaticResource PropertyFieldTextAreaTemplate}"
            IntTemplate="{StaticResource PropertyFieldIntTemplate}"
            FloatTemplate="{StaticResource PropertyFieldFloatTemplate}"
            ColorTemplate="{StaticResource PropertyFieldColorTemplate}"
            EnumTemplate="{StaticResource PropertyFieldEnumTemplate}"
            BoolTemplate="{StaticResource PropertyFieldBoolTemplate}"
            SliderTemplate="{StaticResource PropertyFieldSliderTemplate}"/>
    </UserControl.Resources>

    <Grid Margin="12">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>

        <!-- Header -->
        <TextBlock Grid.Row="0" FontSize="14" FontWeight="Bold" Foreground="#64b5f6"
                   Margin="0,0,0,12" Text="{Binding HeaderText}"/>

        <!-- No selection -->
        <TextBlock Grid.Row="1" Text="Select an element on canvas to edit properties"
                   Foreground="#7a8a96" FontStyle="Italic"
                   Visibility="{Binding SelectedElement, Converter={StaticResource NullToVisibilityConverter}}"/>

        <!-- Properties list -->
        <ScrollViewer Grid.Row="1" VerticalScrollBarVisibility="Auto"
                     Visibility="{Binding SelectedElement, Converter={StaticResource ObjectToVisibilityConverter}}">
            <ItemsControl ItemsSource="{Binding Properties}"
                          ItemTemplateSelector="{StaticResource PropertyFieldTemplateSelector}"/>
        </ScrollViewer>
    </Grid>
</UserControl>
